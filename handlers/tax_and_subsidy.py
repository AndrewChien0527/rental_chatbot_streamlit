import streamlit as st

def add_chat(role, content):
    with st.chat_message(role):
        st.markdown(content)
    st.session_state.messages.append({"role": role, "content": content})

def handle_tax_and_subsidy():
    
    add_chat("assistant", '''
一、常見的租屋補助方案
| 補助名稱                | 適用對象         | 金額                       | 申請條件                       |
| ------------------- | ------------ | ------------------------ | -------------------------- |
| **租金補貼**            | 弱勢族群、青年、家庭   | 每月最高 8,000 元（依縣市與家戶人數分級） | 有租賃契約、有報稅、有設籍，且家庭收入在一定標準以下 |
| **包租代管補助**          | 房東、房客均可申請    | 房客每月補助租金、房東享稅賦優惠         | 須透過政府認可之代管業者簽訂契約           |
| **青年租屋補助**          | 年輕族群（20～40歲） | 北北基最多每月 5,000 元          | 須有正式租約、家庭所得限制              |
| **中低收入戶、身心障礙者租屋補助** | 特殊身份         | 補助額度較高                   | 須有設籍與身份證明                  |


二、租金報稅與相關稅務規範
對房客（你）來說：
✅ 你可以報稅節稅（列舉扣除額）

條件：有「正式租賃契約」與「房東報稅或開立收據」。

可在綜合所得稅報稅時申報 租金支出，每年最多可抵稅 12 萬元（即每月 10,000 元內）。

⚠️ 若房東未報稅，你報稅將可能導致房東被查稅

建議與房東溝通是否願意開立「租金收據」並報稅。

二、租金報稅與相關稅務規範
對房客（你）來說：
✅ 你可以報稅節稅（列舉扣除額）

條件：有「正式租賃契約」與「房東報稅或開立收據」。

可在綜合所得稅報稅時申報 租金支出，每年最多可抵稅 12 萬元（即每月 10,000 元內）。

⚠️ 若房東未報稅，你報稅將可能導致房東被查稅

建議與房東溝通是否願意開立「租金收據」並報稅。

三、免費法律資源（協助租屋糾紛）
🧑‍⚖️ 法律諮詢與協助管道：
| 資源單位                  | 提供內容             | 聯絡方式                                     |
| --------------------- | ---------------- | ---------------------------------------- |
| **法律扶助基金會**           | 免費法律諮詢、必要時提供律師協助 | [www.laf.org.tw](https://www.laf.org.tw) |
| **各縣市政府法扶窗口**         | 定期開放法律諮詢時段       | 可電話或網路預約                                 |
| **司法院法律諮詢網站**         | 基本法律問題線上諮詢       | [law.moj.gov.tw](https://law.moj.gov.tw) |
| **社區法律諮詢（民意代表、社區中心）** | 通常不定期辦理，免費       | 可留意當地公告                                  |


''')
    if "post_input" not in st.session_state:
        st.session_state.post_input = ""

    if not st.session_state.post_input:
        user_text = st.chat_input(" ")
        if user_text:
            st.session_state.post_input = user_text
            return f"收到：\n\n🧐 分析中……（你提供的是：{user_text})"
        else:
            return "請提供事實內容，我才能幫你判斷是否有風險。"
    else:
        # simulate analysis
        return "✅ 根據你提供的資訊，以下是建議您的應對方式。"